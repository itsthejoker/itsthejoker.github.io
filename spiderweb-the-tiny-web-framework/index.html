<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Spiderweb: the Tiny Web Framework - Joe Kaufeld</title><meta name=Description content="Personal writing, projects, and thoughts galore."><meta property="og:url" content="https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/">
<meta property="og:site_name" content="Joe Kaufeld"><meta property="og:title" content="Spiderweb: the Tiny Web Framework"><meta property="og:description" content="I realized that, though it’s my day job to use them, I don’t know how web frameworks work. So I wrote one."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-03T16:26:04-04:00"><meta property="article:modified_time" content="2024-09-19T11:53:34-04:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Spiderweb"><meta property="article:tag" content="Learning"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spiderweb: the Tiny Web Framework"><meta name=twitter:description content="I realized that, though it’s my day job to use them, I don’t know how web frameworks work. So I wrote one."><meta name=twitter:site content="@joekaufeld"><meta name=application-name content="Joe Kaufeld"><meta name=apple-mobile-web-app-title content="Joe Kaufeld"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/><link rel=prev href=https://itsthejoker.github.io/typos-and-bitwise-operations/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Spiderweb: the Tiny Web Framework","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/itsthejoker.github.io\/spiderweb-the-tiny-web-framework\/"},"image":[{"@type":"ImageObject","url":"https:\/\/itsthejoker.github.io\/images\/me.jpg","width":2542,"height":2363}],"genre":"posts","keywords":"python, spiderweb, learning","wordcount":2666,"url":"https:\/\/itsthejoker.github.io\/spiderweb-the-tiny-web-framework\/","datePublished":"2024-09-03T16:26:04-04:00","dateModified":"2024-09-19T11:53:34-04:00","license":"All rights reserved.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Joe Kaufeld"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Joe Kaufeld">Joe Kaufeld</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/software_and_media>Software & Media </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/series/>Series </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Joe Kaufeld">Joe Kaufeld</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/software_and_media title>Software & Media</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/series/ title>Series</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Spiderweb: the Tiny Web Framework</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://joekaufeld.com title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Joe Kaufeld</a></span>&nbsp;<span class=post-category>included in <a href=/categories/projects/><i class="far fa-folder fa-fw" aria-hidden=true></i>Projects</a>&nbsp;<a href=/categories/python/><i class="far fa-folder fa-fw" aria-hidden=true></i>Python</a></span></div><div class=post-meta-line></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-09-03>2024-09-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2666 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;13 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#dangers-lurk-in-the-depths-of-learning>Dangers Lurk in the Depths of Learning</a></li><li><a href=#background>Background</a></li><li><a href=#the-ground-rules>The Ground Rules</a></li><li><a href=#the-framework-begins>The Framework Begins</a></li><li><a href=#spiderweb>Spiderweb</a></li></ul><ul><li><a href=#security-databases--other-fun-tricks>Security, Databases, & Other Fun Tricks</a></li><li><a href=#flexibility-in-odd-places>Flexibility in Odd Places</a></li><li><a href=#takeaways>Takeaways</a><ul><li><a href=#zen-of-python-vs-ease-of-use>Zen of Python vs Ease of Use</a></li><li><a href=#sometimes-python-magic-really-is-the-easiest-way>Sometimes Python Magic really is the easiest way</a></li><li><a href=#having-fun-is-fun>Having Fun is Fun</a></li></ul></li><li><a href=#closing>Closing</a></li></ul></nav></div></div><div class=content id=content><h2 id=dangers-lurk-in-the-depths-of-learning>Dangers Lurk in the Depths of Learning</h2><p>As a professional web developer focusing on arcane uses of <a href=https://www.djangoproject.com/ target=_blank rel="noopener noreffer">Django</a> (and others) for arcane purposes, it occurred to me a little while ago that I didn&rsquo;t actually know how a web framework <em>worked</em>.</p><blockquote><p>So I built one.</p></blockquote><p>This is that story (and lessons learned).</p><hr><h2 id=background>Background</h2><p>For almost a decade, I have a made a living of weaving websites and apps into existence with Django. I&rsquo;ve used it in lots of different contexts:</p><ul><li>the login experience for USA TODAY</li><li>moving millions of dollars a day to get clients paid on time</li><li><a href="https://filamentcolors.xyz?ref=itsthejoker.github.io" target=_blank rel="noopener noreffer">FilamentColors.xyz</a>, my website for comparing different colors of 3D-printing filaments</li></ul><p>&mldr;just to name a few. It&rsquo;s such a flexible tool that I never feel that I need to reach for anything else; if there&rsquo;s functionality that it doesn&rsquo;t have built-in, then usually the answer is that either &ldquo;it actually <em>is</em> built in and I just haven&rsquo;t found it yet&rdquo; or &ldquo;someone else has already written it and it&rsquo;s just one install command away&rdquo;. I&rsquo;ve written several extensions for Django over the years (rarely ones that see the light of day outside of a corporation), and if I can say anything about the building experience, it&rsquo;s that It Just Works&#8482;&#xfe0f;.</p><p>Since my job is building websites (and other cool stuff, but mostly websites), I have to know a lot about my frameworks of choice, but I realized that I didn&rsquo;t really know how it all actually <em>worked</em>. How does routing route? What does the request <em>really</em> look like? How does capturing variables from a URL without requiring the user to write regex work? Sure, I <em>could</em> just crack open Django and Flask to see how the sausage is made&mldr; or I could just build it myself and learn while I went.</p><h2 id=the-ground-rules>The Ground Rules</h2><p>There were only a handful of actual &lsquo;rules&rsquo; that I set for myself. They were, in no particular order:</p><ul><li>write as much as possible on my own — no looking at existing code<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>take parts I liked about both Django and Flask and merge them together</li><li>be easy to configure</li><li>learn a lot</li></ul><p>For the parts that I liked, I had a list of features in mind that I wanted my framework to have (mostly because I wanted to know how they worked):</p><ul><li>Flask&rsquo;s <code>@app.route()</code> decorator for route assignments</li><li>URLs with variables in them</li><li>Middleware</li><li>Sessions</li><li>gunicorn support</li><li>database support</li></ul><p>It&rsquo;s important to have goals, ya know? So&mldr; Python has a <a href=https://docs.python.org/3/library/http.server.html#http.server.SimpleHTTPRequestHandler target=_blank rel="noopener noreffer">simple HTTP webserver built in</a>. Could I just subclass that and start expanding on it?</p><figure><a class=lightgallery href=/gifs/my-gut-says-maybe.gif title="A gif from Futurama showing a one-shot character saying &lsquo;all I know is that my gut says: maybe&rsquo;." data-thumbnail=/gifs/my-gut-says-maybe.gif data-sub-html="<h2>I frequently find myself agreeing with this guy.</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/gifs/my-gut-says-maybe.gif data-srcset="/gifs/my-gut-says-maybe.gif, /gifs/my-gut-says-maybe.gif 1.5x, /gifs/my-gut-says-maybe.gif 2x" data-sizes=auto alt="A gif from Futurama showing a one-shot character saying &lsquo;all I know is that my gut says: maybe&rsquo;." width=500 height=375></a><figcaption class=image-caption>I frequently find myself agreeing with this guy.</figcaption></figure><h2 id=the-framework-begins>The Framework Begins</h2><p>The answer is, surprisingly, &ldquo;yes!&rdquo;, and I eagerly started building. A few days later, I had some functionality I was proud of:</p><ul><li>user-writable views</li><li>mapping routes (URLs) to views</li><li>properly parsing URLs with variables in them</li><li><code>GET</code> and <code>POST</code> requests</li><li>HTML template rendering</li><li>HTTP redirects</li><li>basic middleware for handling requests and responses</li></ul><p>I named my little pet project <a href=https://itsthejoker.github.io/spiderweb target=_blank rel="noopener noreffer"><strong>Spiderweb</strong></a> (a web framework just large enough for a spider), and I sent it off to some friends to get feedback on what I was doing well and what wasn&rsquo;t going well. Out of that feedback, I got two feature requests (<a href="https://itsthejoker.github.io/spiderweb/#/routes?id=during-instantiation" target=_blank rel="noopener noreffer">Django-style route declaration</a> and <a href=https://itsthejoker.github.io/spiderweb/#/middleware/pydantic target=_blank rel="noopener noreffer">form validation with Pydantic</a>), so I got that figured out and kept building. Though I&rsquo;d been putting it off, there was a specific thing that I wanted to make sure I had: <a href=https://gunicorn.org/ target=_blank rel="noopener noreffer">gunicorn support</a>. Gunicorn is the standard runner for production software for pretty much every project I&rsquo;ve ever worked on (<a href=https://uwsgi-docs.readthedocs.io/en/latest/ target=_blank rel="noopener noreffer">shoutouts to uWSGI though</a>), so ensuring that my baby framework could interact with it was paramount.</p><p>Gunicorn uses a system called <a href=https://wsgi.readthedocs.io/en/latest/index.html target=_blank rel="noopener noreffer">WSGI</a> (Web Server Gateway Interface) to communicate, so I launched into getting my little framework to speak it. And after poking at it for a while, I had a horrifying realization: there is no way to directly translate <code>SimpleHTTPServer</code> to WSGI.</p><p>When I started this whole adventure, I thought &ldquo;you know, the WSGI standard has been around forever, so it&rsquo;s probably not an issue. How hard can this be?&rdquo; The WSGI standard has indeed been around <a href=https://peps.python.org/pep-0333/ target=_blank rel="noopener noreffer">since 2003</a> — which in computing years is essentially forever — but what I&rsquo;d failed to take into account is that <code>SimpleHTTPServer</code> has been around <em>foreverer</em>.</p><figure><a class=lightgallery href=/images/basehttpserver_first_commit.png title="A screenshot of the first ever commit for BaseHTTPServer, showing August 3rd, 1995 by Guido Van Rossum" data-thumbnail=/images/basehttpserver_first_commit.png data-sub-html="<h2>For those keeping track at home, this is part of Python 1.3.</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/basehttpserver_first_commit.png data-srcset="/images/basehttpserver_first_commit.png, /images/basehttpserver_first_commit.png 1.5x, /images/basehttpserver_first_commit.png 2x" data-sizes=auto alt="A screenshot of the first ever commit for BaseHTTPServer, showing August 3rd, 1995 by Guido Van Rossum" width=354 height=167></a><figcaption class=image-caption>For those keeping track at home, this is part of Python 1.3.</figcaption></figure><h2 id=spiderweb>Spiderweb</h2><p>Frustrated, I opened a new file and got writing. Starting from a <a href=https://wsgi.tutorial.codepoint.net/application-interface target=_blank rel="noopener noreffer">minimal viable example</a> of what serving a WSGI application looks like, I reworked all of my logic to fit into this new paradigm, then began to extend. More middleware capabilities came first, then session middleware (and database support), then CSRF middleware, custom error routes, HTML templates, cookies, and most importantly, gunicorn support! Keeping a connection to <code>SimpleHTTPServer</code> let me keep an &ldquo;insecure dev server&rdquo; for doing local work, and some careful work in the documentation and examples meant that the dev server and gunicorn could both be used at the same time without changing the code.</p><p>For folks who have experience with building websites in Python, it should feel pretty familiar:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>spiderweb</span> <span class=kn>import</span> <span class=n>SpiderwebRouter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>spiderweb.response</span> <span class=kn>import</span> <span class=n>HttpResponse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>SpiderwebRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;HELLO, WORLD!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Running the file will result in a default server being created on <code>http://localhost:8000</code>, and navigating there in your browser of choice should show &ldquo;HELLO WORLD&rdquo; as the only content.</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Docs!<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Since this post is more about writing Spiderweb more than using it, you can <a href=https://itsthejoker.github.io/spiderweb/#/quickstart target=_blank rel="noopener noreffer">check out the code above and more at the docs</a>!</div></div></div><p>When I was thinking about what I wanted the user experience of views to look like, I made a specific decision that would impact a surprising number of things: a view should not return <em>data</em> (e.g. a string or a dict) but should instead return an explicit intent (with data) from the user of what they expect the framework to do. Some frameworks I&rsquo;ve used over the years make assumptions about what exactly the user wants — for example, a returning a dict must mean they want a JSON response — and I think that&rsquo;s kinda silly. Sending data back to the browser should be a deliberate action, and the form that it takes should also be deliberate.</p><p>This splits the overall lifecycle of an HTTP request into three parts: the Request, the View, and the Response. These three parts have a total of five states:</p><ol><li>Browser creates a <code>Request</code></li><li>All middleware that can do so processes the <code>Request</code> object</li><li>User-created View receives the <code>Request</code> and returns a <code>Response</code></li><li>All middleware that can do so processes the <code>Response</code> object</li><li>Spiderweb renders the finished <code>Response</code> and sends it to the browser</li></ol><p>I ended up settling on five different responses, with each one automatically setting the correct headers for you (but can be overridden easily):</p><ul><li><code>HttpResponse</code><ul><li>This is the base response class, and it takes in text that is directly rendered.</li></ul></li><li><code>JsonResponse</code></li><li><code>TemplateResponse</code><ul><li>Takes in either a path to a Jinja template file or a string template, then renders it with optional context data.</li></ul></li><li><code>RedirectResponse</code><ul><li>Takes in the path you want to redirect to, then tells the browser to go there instead.</li></ul></li><li><code>FileReponse</code><ul><li>Sending files can be kind of a pain, and I realized when working with the dev server that it needed to be able to serve its own static files. The <code>FileResponse</code> is mostly for internal use, but is certainly available for others if they need it or want to use it.</li></ul></li></ul><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Funnily enough, implementing <code>FileResponse</code> was where I realized why <a href=https://docs.djangoproject.com/en/5.1/ref/contrib/staticfiles/#django.contrib.staticfiles.views.serve target=_blank rel="noopener noreffer">a notice that I&rsquo;d seen before</a> from the Django documentation about not serving static files via the framework was actually there. To properly serve a file, not only does the request have to go through the entirety of the middleware stack twice (once for the request and once for the response), it probably is also insecure just by nature of it existing.</p><p>So, like&mldr; maybe don&rsquo;t do that with Spiderweb either.</p></div></div></div><p>All of the Response classes have a <code>.render()</code> function that builds the response into something that can be returned to the browser. This has made extending the Response types with your own very easy, and I&rsquo;m very happy with how it all came together!</p><h1 id=stuff-i-learned>Stuff I Learned</h1><h2 id=security-databases--other-fun-tricks>Security, Databases, & Other Fun Tricks</h2><p>Not everything was happiness and rainbows; the internet is a dangerous place, after all. Any framework that accepts POST request also needs to be able to protect against <a href=https://owasp.org/www-community/attacks/csrf target=_blank rel="noopener noreffer">Cross-Site Request Forgery (CSRF)</a>, which required a lot more research than I had expected. I implemented a naïve version when building the first version of Spiderweb, only to have a coworker point out that my implementation was essentially a complete failure at what it was supposed to do.</p><p>Hilarious.</p><p>Implementing it properly involved first adding in database support so that I could build the session middleware, then finally re-implementing CSRF correctly. For database support, I ended up going with <a href=https://docs.peewee-orm.com/en/latest/peewee/quickstart.html target=_blank rel="noopener noreffer"><code>peewee</code></a>, a Python-based <a href=https://stackoverflow.com/a/1279678 target=_blank rel="noopener noreffer">Object Relational Mapper (ORM)</a> for interacting with different common databases like SQLite and Postgres.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>The Best ORM<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>The best ORM, by far, is actually the one built into Django. Called simply &ldquo;the Django ORM&rdquo;, this system of interacting with databases is incredibly solid, flexible, and takes the idea of &ldquo;if you can&rsquo;t model your query with it, there&rsquo;s a bug&rdquo; to extremes.</p><p>However, the ORM is built into Django in such a way that it cannot be easily extricated. It is <a href=https://forum.djangoproject.com/t/django-orm-as-a-standalone-library/4971 target=_blank rel="noopener noreffer">technically possible to run the ORM as a standalone project</a>, but it would require downloading the entirety of the Django web framework while using Spiderweb, which definitely <a href=https://github.com/itsthejoker/spiderdjango target=_blank rel="noopener noreffer">enters the territory of &ldquo;&mldr;but why?&rdquo;</a>.</p></div></div></div><p>After rebuilding CSRF protection the proper way, I moved on to another security feature that is often an afterthought for other systems (until it&rsquo;s suddenly very much needed): <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS target=_blank rel="noopener noreffer">Cross-Origin Resource Sharing (CORS)</a>, a vital part of keeping users safe while allowing for larger and more distributed projects. Though it had been my plan from the beginning to implement everything myself and put my own spin on things, I admitted defeat here; the consequences of having a poor implementation here were too high. I turned to <a href=https://github.com/adamchainz/django-cors-headers/ target=_blank rel="noopener noreffer">django-cors-headers</a>, a project started in 2013 that has been a trusted staple of many production jobs that I&rsquo;ve worked on over the years.</p><p>Translating <code>django-cors-headers</code> into the language of Spiderweb wasn&rsquo;t an easy task, but it did help me better to understand some of the intricacies of the security layer and, in porting the tests that accompany it to make sure I translated it correctly, I discovered several other small bugs in Spiderweb itself that I was able to fix. Roughly 1/3rd of the total development time went into CORS and CSRF protection alone.</p><h2 id=flexibility-in-odd-places>Flexibility in Odd Places</h2><p>As Spiderweb grew, I was continually surprised by how much I could actually implement in the middleware layer. By extension, I was equally surprised with how much logic didn&rsquo;t actually have to be hard-coded into the framework. As both my coworkers and I floated ideas, I kept thinking, &ldquo;<em>where would this go&mldr; can I put it in middleware? I think I can!</em>&rdquo;. Ensuring Spiderweb had extensive (and clear) middleware support means that not only can features be turned on and off at will, but also that new features are very easy for the end user to write for their own personal applications.</p><p>I&rsquo;ve always known that middleware was powerful, but the sheer amount that it could handle definitely surprised me. I&rsquo;m very much looking forward to seeing other options for middleware if anyone ends up writing some!</p><h2 id=takeaways>Takeaways</h2><p>In working on Spiderweb, there were a lot of surprises and interesting rabbit holes that I went down while working on the entire system. There were times where I was working on different pieces and thought &ldquo;wait, it would be really nice if&mldr;&rdquo; or, when working on the documentation, I would start to document a function that seemed like it should be there because it made logical sense to be there (like <code>app.reverse()</code> for <a href="https://itsthejoker.github.io/spiderweb/#/routes?id=finding-routes-again" target=_blank rel="noopener noreffer">getting the urls from the name of the route</a>). In no particular order, these are some of the things that stood out to me while finishing this project.</p><h3 id=zen-of-python-vs-ease-of-use>Zen of Python vs Ease of Use</h3><p>The <a href=https://en.wikipedia.org/wiki/Zen_of_Python target=_blank rel="noopener noreffer">Zen of Python</a> says, among other things:</p><blockquote><p>There should be one&ndash; and preferably only one &ndash;obvious way to do it.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p></blockquote><p>When starting on Spiderweb, I had a very specific idea of how I wanted the framework to be used, but I found multiple areas where it just made logical sense to have different ways of achieving the same goal for ease of use. Different situations called for different uses, which is why Spiderweb ended up with <a href=https://itsthejoker.github.io/spiderweb/#/routes target=_blank rel="noopener noreffer">three different ways to set up routes</a>. I have a preference, but therre&rsquo;s no need to force a preference onto situations where it makes less sense, especially as applications grow.</p><h3 id=sometimes-python-magic-really-is-the-easiest-way>Sometimes Python Magic really is the easiest way</h3><p>In spending years working with Django, there are some things that I have always simply ascribed to &ldquo;Django Magic&rdquo;. Python has its own forms of magic, but the idea that there were some design decisions that just needed to be memorized was always a little annoying. In working on Spiderweb, there were several places where I intuitively leaned on either more obscure or &ldquo;maybe not quite good practices&rdquo; areas of Python to accomplish what I needed — for example, finding the base path of the script calling Spiderweb is done by inspecting the call stack and variables in a URL are cast to their final types by building class names and querying <code>globals()</code>. This likely seems&mldr; questionable&mldr; to the outside viewer, but they are decisions that made the most sense at the time and were easy to quickly implement.</p><p>That&rsquo;s not to say that these two are examples that should stay in the framework as time goes on; if I end up continuing to support and extend Spiderweb, there are some definite areas for improvement, and these would likely get some intense scrutiny early on. Like many instances of &ldquo;Django Magic&rdquo;, I&rsquo;m sure that they&rsquo;re just what made sense at the time as opposed to a focus on the proper way to approach the problem.</p><h3 id=having-fun-is-fun>Having Fun is Fun</h3><p>With many projects, this one included, there is a certain &lsquo;slump&rsquo; period that happens towards the end. So much work has been completed, but it feels like there&rsquo;s so much left to do&mldr; and more projects than not die in this stage. With Spiderweb though, I tried to focus on the parts of building that I genuinely found fun to keep me going.</p><p>In this case, I really enjoyed working on the middleware; expanding the framework&rsquo;s capabilities in such a modular way was very exciting, and it became almost a game with myself to see how far I could push the functionality without changing anything in the core server. Having this area that I could come back to was incredibly helpful in keeping me moving and focused.</p><p>So, in the words of my partner as we talked about what I learned while working on Spiderweb&mldr; &ldquo;fun is fun!&rdquo;</p><h2 id=closing>Closing</h2><p>If any of this looks interesting, I encourage you to check out <a href=https://itsthejoker.github.io/spiderweb target=_blank rel="noopener noreffer">Spiderweb</a> and see if it&rsquo;s the framework for your next project (or if it&rsquo;s just worth tinkering with). If you find some issues, let me know! It&rsquo;s essentially a toy, but like any creator, I&rsquo;m dying to know what my creation is capable of. May it serve your requests as well as it has served mine!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I almost made it. All of the core functionality is my own work, but I leaned on <a href=https://github.com/adamchainz/django-cors-headers/ target=_blank rel="noopener noreffer">the shoulders of giants</a> for implementing <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS target=_blank rel="noopener noreffer">CORS (Cross-Origin Resource Sharing)</a>, as it&rsquo;s really something I did not want to screw up.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The formatting of the dashes is specifically different as an illustration of there being different ways to format Python code. It&rsquo;s included <a href=https://bugs.python.org/issue3364 target=_blank rel="noopener noreffer">as an Easter egg by the author</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2024-09-19</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/spiderweb-the-tiny-web-framework/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/ data-title="Spiderweb: the Tiny Web Framework" data-via=joekaufeld data-hashtags=python,spiderweb,learning><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/ data-hashtag=python><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Tumblr" data-sharer=tumblr data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/ data-title="Spiderweb: the Tiny Web Framework" data-tags=python,spiderweb,learning><i class="fab fa-tumblr fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/ data-title="Spiderweb: the Tiny Web Framework"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://itsthejoker.github.io/spiderweb-the-tiny-web-framework/ data-title="Spiderweb: the Tiny Web Framework"><i data-svg-src=/lib/simple-icons/icons/line.min.svg aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/python/>Python</a>,&nbsp;<a href=/tags/spiderweb/>Spiderweb</a>,&nbsp;<a href=/tags/learning/>Learning</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/typos-and-bitwise-operations/ class=prev rel=prev title="Typos and Bitwise Operations"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Typos and Bitwise Operations</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://joekaufeld.com target=_blank>Joe Kaufeld</a></span>&nbsp;|&nbsp;<span class=license>All rights reserved.</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://plausible.io/js/plausible.js async defer data-domain=itsthejoker.github.io></script></body></html>